let menuShown=!1;const toggleMenu=()=>{if(!menuShown){const n=document.createElement("div");n.className="menu";var e=document.createElement("div"),t=(e.style=`
      max-width: 400px;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
    `,document.createElement("button"));t.style="aspect-ratio: 1; font-size: 2em; font-weight: bold; padding-left: 0.99em; padding-right: 0.99em;",t.innerText="⤒",t.onclick=()=>{menuShown=!1,n.remove();const e=document.createElement("div");e.className="outMenu",e.innerHTML=n.innerHTML,document.body.appendChild(e),setTimeout(()=>{e.remove()},400)},e.appendChild(t),n.appendChild(e),document.body.appendChild(n)}},createMenu=()=>{var e=document.createElement("div");e.className="topBar",e.onclick=toggleMenu,document.body.appendChild(e)},addNote=(e,t)=>{},touchResolution=10,clearScreen=()=>{document.getElementById("main").remove(),g$.buttonCount=0},getDistance=(e,t)=>{return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},getAngle=(e,t)=>{var n=e.x-t.x,e=e.y-t.y,t=Math.atan2(e,n);switch(Math.floor(4*t/Math.PI)){case-1:case 0:return"right";case 1:case 2:return"down";case 3:case-4:return"left";case-2:case-3:return"up";default:return}},createPage=()=>{let t={x:0,y:0},n,e=document.getElementsByClassName("topRoot")[0];var a=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),l=document.createElement("div");e||((e=document.createElement("div")).className="topRoot",document.body.appendChild(e)),e.appendChild(a),a.className="main",a.id="main",o.className="page",o.id="page",s.id="input",i.className="btns",i.id="btns",l.className="swipeArea",l.id="btns",l.addEventListener("touchstart",e=>{t={x:e.touches[0].clientX,y:e.touches[0].clientY}}),l.addEventListener("touchend",e=>{n={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},getDistance(t,n)>touchResolution?(e=getAngle(t,n))&&handleDirection(e):g$.singleTap&&g$.singleTap()}),e.appendChild(a),a.appendChild(o),a.appendChild(s),a.appendChild(i),a.appendChild(l)};let g$={},l$={},c$={};const skylight=(e,t=!1)=>{let i=0;const n=t?"div":"p";return e.split("\n").map(e=>e.trim()).join("\n").split("\n\n").filter(e=>""!==e).map(e=>`<${n}>${(a=>{const o={quote:!0,bold:!0,italic:!0};var e=(e,t,n)=>{for(;-1<a.indexOf(e);)a=o[t]?a.replace(e,`<${n}>`):a.replace(e,`</${n}>`),o[t]=!o[t]},t=(t,n)=>a=a.split("\n").map(e=>0===e.trimStart().indexOf(t)?`<${n}>${e.replace(t,"")}</${n}>`:e).join("\n");t("#### ","h4"),t("### ","h3"),t("## ","h2"),t("# ","h1"),a=(a=a.replace("\\'","^&^$$")).replace('\\"',"^&^##");for(var n="[[";-1<a.indexOf(n);)a=i%2==0?a.replace(n,"&ldquo;"):a.replace(n,"&lsquo;"),i+=1;for(var s="]]";-1<a.indexOf(s);)--i,a=i%2==0?a.replace(s,"&rdquo;"):a.replace(s,"&rsquo;");for(e("``","quote","q"),e('"',"quote","q"),e("**","bold","b"),e("*","italic","i");-1<a.indexOf("'");)a=a.replace("'","&rsquo;");return a=(a=(a=a.replace("^&^$$","'")).replace("^&^##",'"')).trim()})(e)}</${n}>`).join("")};function stringToHash(e){var t=0;if(0!=e.length)for(i=0;i<e.length;i++)t=(t<<5)-t+(char=e.charCodeAt(i)),t&=t;return t}Game.yates={name:"Yates",location:"start",hasMet:!0,topics:["repairs","needs"],talk:{desc:`
        
        Yates peers blandly at you from under the damaged bulkhead.

        `,look:`

        "Hey, I'm kind of busy here," Yates says with mild annoyance.

        @suggest

        `,repairs:[["Thanks for all the hard work",`
            
            "I know!" says Yates.
            
            `]],bye:[["Well, keep working, we need to get off this rock",`
            
            "Keep working," you say, "We need to get off this rock."

            "I know, I'm on it," says Yates. @end @set-name {Blobby}
            
            `],["I wish you'd hurry up",`
            
            "I wish you'd hurry up," you say.
            
            Yates only grumbles in response. $annoyed @end
            
            `]]},annoyed:{desc:`
        
        Yates is apparently ignoring you.

        `,look:`

        "Hey, I'm kind of busy here," Yates says with mild annoyance.

        `}},Game.insideShip={desc:`
    
    This part of the ship appears to be the least damaged—in retrospect, it's good you were here
    during the crash. The hypersleep pod is offline, as are most other systems; Yates will probably
    have them on and off repeatedly as he makes his repairs. A mostly undamaged ladder leads up to
    the cockpit, and an open airlock on your right heads to the exterior of the ship.

    `,swipeRight:()=>go("start")},Game.start={desc:`
   
   Lying close to the edge of a cliff is your ship, presently more of an accordion than a spacecraft. Straight left
   the airlock hangs open, and a winding path leads down to a little village in the valley below.
   
   `,swipeUp:"Going that way would send you directly over the cliff.",swipeLeft:()=>go("insideShip")},Game.topics={festival:["party","gathering","event","venue"]},window.addEventListener("load",()=>{g$={...Game},createMenu(),createPage(),go("start")});const getDesc=e=>{e=e||g$.isTalking;var[t,,n]=getName(e),a=g$[e].state??"talk";if(!hasMet(e)&&g$[e][a].notMet)return"function"==typeof g$[e][a].notMet?g$[e][a].notMet():(g$[e][a].notMet,g$[e].notMet??capitalize(n+` ${t} is here.`));if(g$[e][a].desc){if("function"==typeof g$[e][a].desc)return g$[e][a].desc();if("string"==typeof g$[e][a].desc)return g$[e][a].desc}return g$[e][a].desc??capitalize(n+` ${t} is here.`)},getName=e=>(e=e||g$.isTalking,hasMet(e)?[g$[e].name,"","",""]:[g$[e].name,"a","the","that"]),setName=(e,t)=>{t=t||g$.isTalking,g$[t].name=e},hasMet=e=>(e=e||g$.isTalking,g$[e].hasMet),getLocation=e=>{return(e?g$[e]:c$).location},setLocation=(e,t)=>{(t?g$[t]:c$).location=e},getState=e=>(e=e||g$.isTalking,g$[e].state||"talk"),setState=(e,t)=>{e=e??"talk";t=t||g$.isTalking,g$[t].state=e,g$.isTalking===t&&(g$.lastNode=g$[t][e])},hasVisited=e=>{return e=e||g$.currentLocationName,g$[e].visited??0},talk=e=>{g$.isTalking=e,(c$=g$[e]).hasMet=!0;var t=c$?.state??"talk";g$.lastNode=g$[e][t],document.getElementById("main").classList.add("outFade"),setTimeout(()=>{clearScreen(),createPage(),handleCharacterLook(),showInput()},450)},handleCharacterLook=()=>{var e=c$?.state??"talk";if(!c$[e].look)throw"Node has no desc property: "+nodeIdentifier;"function"==typeof c$[e].look?c$[e].look():msg(c$[e].look)},setTopic=e=>{var t=document.getElementById("inputBox");t&&(t.value=e,g$.input=e,refreshButtons())},suggestTopics=()=>{msg(`
  
  <div class="suggested-topics">[You could discuss ${c$.topics.map(e=>"#"+e).join(", ")} or just say #bye for now.]</div>
  
  `,{skipSkylight:!0})},characterLink=(e,t)=>`
    
    <div onclick="talk('${e}')">${skylight(t)}</div>
    
`,refreshButtons=()=>{const s=document.getElementById("btns");var e=getState(),t=g$.input;s.innerHTML="",c$[e][t]&&c$[e][t].map(e=>{var t=document.createElement("button"),n=document.createElement("div");const[a,o]=e;n.innerText=a,n.className="buttonText",t.onclick=()=>{clearScreen(),createPage(),showInput(),"string"==typeof o?msg(o):o()},t.appendChild(n),s.appendChild(t)})},showInput=()=>{g$.input="";var e=document.getElementById("input");e.innerHTML="";const t=document.createElement("input"),n=document.getElementById("page").innerHTML;t.type="text",t.name="inp",t.placeholder="Enter here",t.class="inp",t.id="inputBox",t.autofocus=!0,t.oninput=()=>{var e=document.getElementById("page");g$.input=t.value.toLowerCase(),refreshButtons(),g$.input?e.innerHTML="":e.innerHTML=n},e.appendChild(t)},msg=(e,t)=>{let n="string"==typeof e?e:e();if(t?.skipSkylight||(n=skylight(n,t?.skipParagraphTags)),g$.isTalking){var e=Object.keys(c$),t="@suggest";-1<n.indexOf("@end")&&(endConversation(),n=n.replace("@end","")),-1<n.indexOf(t)&&(suggestTopics(),n=n.replace(t,"")),-1<n.indexOf("@set-name")&&(t=n.split("@set-name {")[1].split("}")[0],n=n.replace(`@set-name {${t}}`,""),setName(t)),-1<n.indexOf("@set-loc")&&(t=n.split("@set-loc {")[1].split("}")[0],n=n.replace(`@set-loc {${t}}`,""),setLocation(t));for(const i of e){var a="$"+i;-1<n.indexOf(a)&&(n=n.replace(a,""),setState(i))}for(const l of e)for(const c of Object.keys(c$[l])){var o=c,s="#"+c;-1<n.indexOf(s)&&(n=n.replace(s,`<span class="topic" onclick="setTopic('${c}')">${o}</span>`),setState(l))}}t=document.getElementById("page");t&&(t.innerHTML+=n)},handleCharactersInLocations=()=>{Object.keys(g$).map(e=>{var t;g$[e]?.location&&g$.location===g$[e]?.location&&(t=getDesc(e),msg(characterLink(e,t),{skipSkylight:!0}))})},handleDirection=e=>{const t="swipe"+(e=capitalize(e));setDefaultSingleTap(),l$[t]&&(l$[t]?.verify?l$[t].verify()&&l$[t].execute():"string"==typeof g$[t]?msg(l$[t]):(document.getElementById("main").classList.add("out"+e),setTimeout(()=>{clearScreen(),createPage(),"string"==typeof l$[t]?msg(l$[t]):l$[t]()},450)))},setDefaultSingleTap=()=>{g$.singleTap=()=>{document.getElementById("main").classList.add("outFade"),setTimeout(()=>{clearScreen(),createPage(),handleDesc()},450)}},handleDesc=()=>{if(!l$.desc)throw"Node has no desc property: "+nodeIdentifier;var e=l$?.state;e?"function"==typeof l$.desc?l$[e].desc():msg(l$[e].desc):"function"==typeof l$.desc?l$.desc():msg(l$.desc),g$.singleTap=void 0,handleCharactersInLocations()},capitalize=e=>e[0].toUpperCase()+e.slice(1),go=e=>{if(!g$[e])throw"Node identifier (GameLocationID) does not exist: "+e;g$.isTalking="",l$=g$[e],g$.location=e,l$.name=e,handleDesc()},endConversation=()=>{var e=document.getElementById("input"),t=document.getElementById("btns");e.innerHTML="",t.innerHTML="",g$.singleTap=()=>{document.getElementById("main").classList.add("outFade"),setTimeout(()=>{clearScreen(),createPage(),handleDesc()},450)}},shuffle=e=>{let t=e.length,n;for(;0!=t;)n=Math.floor(Math.random()*t),t--,[e[t],e[n]]=[e[n],e[t]];return e},roll=e=>e>=Math.floor(100*Math.random()),countdown=e=>1<e.length?e.pop():e[0],pick=e=>{var t=`p{${stringToHash(e.join("-"))}}`;return g$[t]&&g$[t]?.length||(g$[t]=shuffle([...e])),g$[t].pop()},showTipBox=e=>{const t=document.createElement("div");t.className="tipBox",t.id="tipBox";var n=document.createElement("div"),a=(n.className="tipInnerBox",n.id="tipInnerBox",document.createElement("div"));a.className="tipInnerText",a.id="tipInnerText",a.innerText=e,n.appendChild(a),t.appendChild(n),t.onclick=()=>t.remove(),document.body.appendChild(t)},getVal=e=>(g$.values||(g$.values={}),g$.values[e]??!1),setVal=(e,t)=>{g$.values||(g$.values={}),g$.values[e]=t};