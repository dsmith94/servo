let menuShown=!1;const toggleMenu=()=>{},createMenu=()=>{},touchResolution=10,clearScreen=()=>{document.getElementById("main").remove(),g$.buttonCount=0},getDistance=(e,t)=>{return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},getAngle=(e,t)=>{var a=e.x-t.x,e=e.y-t.y,t=Math.atan2(e,a);switch(Math.floor(4*t/Math.PI)){case-1:case 0:return"right";case 1:case 2:return"down";case 3:case-4:return"left";case-2:case-3:return"up";default:return}},createPage=()=>{let t={x:0,y:0},a,e=document.getElementsByClassName("topRoot")[0];var n=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div");e||((e=document.createElement("div")).className="topRoot",document.body.appendChild(e),e.addEventListener("touchstart",e=>{t={x:e.touches[0].clientX,y:e.touches[0].clientY}}),e.addEventListener("touchend",e=>{a={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY},getDistance(t,a)>touchResolution?(e=getAngle(t,a))&&handleDirection(e):g$.singleTap&&g$.singleTap()})),e.appendChild(n),n.className="main",n.id="main",o.className="page",o.id="page",i.id="input",s.className="btns",s.id="btns",e.appendChild(n),n.appendChild(o),n.appendChild(i),n.appendChild(s)};let g$={},l$={},c$={};const skylight=(e,t=!1)=>{let s=0;const a=t?"div":"p";return e.split("\n").map(e=>e.trim()).join("\n").split("\n\n").filter(e=>""!==e).map(e=>`<${a}>${(n=>{const o={quote:!0,bold:!0,italic:!0};var e=(e,t,a)=>{for(;-1<n.indexOf(e);)n=o[t]?n.replace(e,`<${a}>`):n.replace(e,`</${a}>`),o[t]=!o[t]},t=(t,a)=>n=n.split("\n").map(e=>0===e.trimStart().indexOf(t)?`<${a}>${e.replace(t,"")}</${a}>`:e).join("\n");t("#### ","h4"),t("### ","h3"),t("## ","h2"),t("# ","h1"),n=(n=n.replace("\\'","^&^$$")).replace('\\"',"^&^##");for(var a="[[";-1<n.indexOf(a);)n=s%2==0?n.replace(a,"&ldquo;"):n.replace(a,"&lsquo;"),s+=1;for(var i="]]";-1<n.indexOf(i);)--s,n=s%2==0?n.replace(i,"&rdquo;"):n.replace(i,"&rsquo;");for(e("``","quote","q"),e('"',"quote","q"),e("**","bold","b"),e("*","italic","i");-1<n.indexOf("'");)n=n.replace("'","&rsquo;");return n=(n=(n=n.replace("^&^$$","'")).replace("^&^##",'"')).trim()})(e)}</${a}>`).join("")};function stringToHash(e){var t=0;if(0!=e.length)for(i=0;i<e.length;i++)t=(t<<5)-t+(char=e.charCodeAt(i)),t&=t;return t}Game.yates={name:"Yates",location:"start",hasMet:!0,talk:{desc:`
        
        Yates peers blandly at you from under the damaged bulkhead.

        `,look:`

        "Hey, I'm kind of busy here," Yates says with mild annoyance.

        `,bye:[["Well, keep working, we need to get off this rock",`
            
            "Keep working," you say, "We need to get off this rock."

            "I know, I'm on it," says Yates. @end @set-name {Blobby}
            
            `],["I wish you'd hurry up",`
            
            "I wish you'd hurry up," you say.
            
            Yates only grumbles in response. $annoyed @end
            
            `]]},annoyed:{desc:`
        
        Yates is apparently ignoring you.

        `,look:`

        "Hey, I'm kind of busy here," Yates says with mild annoyance.

        `}},Game.insideShip={desc:`
    
    This part of the ship appears to be the least damagedâ€”in retrospect, it's good you were here
    during the crash. The hypersleep pod is offline, as are most other systems; Yates will probably
    have them on and off repeatedly as he makes his repairs. A mostly undamaged ladder leads up to
    the cockpit, and open airlock on your right heads to the exterior of the ship.

    `,swipeRight:()=>go("start")},Game.start={desc:`
   
   Lying close to the edge of a cliff is your ship, crumpled into more of an according than a spacecraft. Straight left
   the airlock hangs open to enter, and a winding path leads down to a little village in the valley below.
   
   `,swipeUp:"Going that way would send you directly over the cliff.",swipeLeft:()=>go("insideShip")},window.addEventListener("load",()=>{g$={...Game},createMenu(),createPage(),go("start")});const getDesc=e=>{e=e||g$.isTalking;var[t,,a]=getName(e),n=g$[e].state??"talk";if(!hasMet(e)&&g$[e][n].notMet)return"function"==typeof g$[e][n].notMet?g$[e][n].notMet():(g$[e][n].notMet,g$[e].notMet??capitalize(a+` ${t} is here.`));if(g$[e][n].desc){if("function"==typeof g$[e][n].desc)return g$[e][n].desc();if("string"==typeof g$[e][n].desc)return g$[e][n].desc}return g$[e][n].desc??capitalize(a+` ${t} is here.`)},getName=e=>(e=e||g$.isTalking,hasMet(e)?[g$[e].name,"","",""]:[g$[e].name,"a","the","that"]),setName=(e,t)=>{t=t||g$.isTalking,g$[t].name=e},hasMet=e=>(e=e||g$.isTalking,g$[e].hasMet),getLocation=e=>{return(e?g$[e]:c$).location},setLocation=(e,t)=>{(t?g$[t]:c$).location=e},getState=e=>(e=e||g$.isTalking,g$[e].state||"talk"),setState=(e,t)=>{e=e??"talk";t=t||g$.isTalking,g$[t].state=e,g$.isTalking===t&&(g$.lastNode=g$[t][e])},hasVisited=e=>{return e=e||g$.currentLocationName,g$[e].visited??0},talk=e=>{g$.isTalking=e,(c$=g$[e]).hasMet=!0;var t=c$?.state??"talk";g$.lastNode=g$[e][t],document.getElementById("main").classList.add("outFade"),setTimeout(()=>{clearScreen(),createPage(),handleCharacterLook(),showInput()},450)},handleCharacterLook=()=>{var e=c$?.state??"talk";if(!c$[e].look)throw"Node has no desc property: "+nodeIdentifier;"function"==typeof c$[e].look?c$[e].look():msg(c$[e].look)},characterLink=(e,t)=>`
    
    <span onclick="talk('${e}')">${skylight(t)}</span>
    
`,msg=(e,t)=>{let a="string"==typeof e?e:e();if(g$.isTalking){e=Object.keys(c$);-1<a.indexOf("@end")&&(endConversation(),a=a.replace("@end","")),-1<a.indexOf("@set-name")&&(o=a.split("@set-name {")[1].split("}")[0],a=a.replace(`@set-name {${o}}`,""),setName(o)),-1<a.indexOf("@set-loc")&&(o=a.split("@set-loc {")[1].split("}")[0],a=a.replace(`@set-loc {${o}}`,""),setLocation(o));for(const i of e){var n="$"+i;-1<a.indexOf(n)&&(a=a.replace(n,""),setState(i))}}var o=document.getElementById("page");!0===t?.skipSkylight?o.innerHTML+=a:o&&(o.innerHTML+=skylight(a,t?.skipParagraphTags))},handleCharactersInLocations=()=>{Object.keys(g$).map(e=>{var t;g$[e]?.location&&g$.location===g$[e]?.location&&(t=getDesc(e),msg(characterLink(e,t),{skipSkylight:!0}))})},handleDirection=e=>{const t="swipe"+(e=capitalize(e));setDefaultSingleTap(),l$[t]&&(l$[t]?.verify?l$[t].verify()&&l$[t].execute():"string"==typeof g$[t]?msg(l$[t]):(document.getElementById("main").classList.add("out"+e),setTimeout(()=>{clearScreen(),createPage(),"string"==typeof l$[t]?msg(l$[t]):l$[t]()},450)))},setDefaultSingleTap=()=>{g$.singleTap=()=>{document.getElementById("main").classList.add("outFade"),setTimeout(()=>{clearScreen(),createPage(),handleDesc()},450)}},handleDesc=()=>{if(!l$.desc)throw"Node has no desc property: "+nodeIdentifier;var e=l$?.state;e?"function"==typeof l$.desc?l$[e].desc():msg(l$[e].desc):"function"==typeof l$.desc?l$.desc():msg(l$.desc),g$.singleTap=void 0,handleCharactersInLocations()},capitalize=e=>e[0].toUpperCase()+e.slice(1),go=e=>{if(!g$[e])throw"Node identifier (GameLocationID) does not exist: "+e;g$.isTalking="",l$=g$[e],g$.location=e,l$.name=e,handleDesc()},endConversation=()=>{var e=document.getElementById("input"),t=document.getElementById("btns");e.innerHTML="",t.innerHTML="",g$.singleTap=()=>{document.getElementById("main").classList.add("outFade"),setTimeout(()=>{clearScreen(),createPage(),handleDesc()},450)}},shuffle=e=>{let t=e.length,a;for(;0!=t;)a=Math.floor(Math.random()*t),t--,[e[t],e[a]]=[e[a],e[t]];return e},roll=e=>e>=Math.floor(100*Math.random()),countdown=e=>1<e.length?e.pop():e[0],pick=e=>{var t=`p{${stringToHash(e.join("-"))}}`;return g$[t]&&g$[t]?.length||(g$[t]=shuffle([...e])),g$[t].pop()},showTipBox=e=>{const t=document.createElement("div");t.className="tipBox",t.id="tipBox";var a=document.createElement("div"),n=(a.className="tipInnerBox",a.id="tipInnerBox",document.createElement("div"));n.className="tipInnerText",n.id="tipInnerText",n.innerText=e,a.appendChild(n),t.appendChild(a),t.onclick=()=>t.remove(),document.body.appendChild(t)},getVal=e=>(g$.values||(g$.values={}),g$.values[e]??!1),setVal=(e,t)=>{g$.values||(g$.values={}),g$.values[e]=t},refreshButtons=()=>{const i=document.getElementById("btns");var e=getState(),t=g$.input;i.innerHTML="",c$[e][t]&&c$[e][t].map(e=>{var t=document.createElement("button"),a=document.createElement("div");const[n,o]=e;a.innerText=n,a.className="buttonText",t.onclick=()=>{clearScreen(),createPage(),showInput(),"string"==typeof o?msg(o):o()},t.appendChild(a),i.appendChild(t)})},showInput=()=>{g$.input="";var e=document.getElementById("input");e.innerHTML="";const t=document.createElement("input"),a=document.getElementById("page").innerHTML;t.type="text",t.name="inp",t.placeholder="Enter here",t.class="inp",t.autofocus=!0,t.oninput=()=>{var e=document.getElementById("page");g$.input=t.value.toLowerCase(),refreshButtons(),g$.input?e.innerHTML="":e.innerHTML=a},e.appendChild(t)};